# Build a conda package from the latest tag.

on:
  release:
         types: [created]
  workflow_dispatch:
         inputs:
            reason:
              description: 'Reason'     
              required: true
              default: 'testing'
  push:
    branches: [ conda-package ]
  pull_request:
    branches: [ conda-package ]
   
  
jobs:
   build-conda:
       runs-on: ubuntu-latest
       
       steps:
          - uses: actions/checkout@v2
          - name: Setup miniconda
            uses: conda-incubator/setup-miniconda@v2
            with:
                auto-update-conda: true
          - name: Install dependencies
            run: |
              conda install --file requirements.txt yaml requests conda-build
              git clone https://github.com/erikmannerfelt/create_conda_meta .
              
          - name: Create conda metadata
            run: |
              $CONDA/env/bin/python make_meta_yml.py --doc_url=https://glacier-lengths.readthedocs.io erikmannerfelt glacier_lengths erikmannerfelt > meta.yaml
              
              conda-build .
              
         
           
     
